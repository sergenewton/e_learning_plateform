{% extends 'base.html' %}

{% block title %}{{ quiz.title }} | {{ course.title }}{% endblock %}

{% block content %}
<div class="container my-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'courses:course_list' %}">Cours</a></li>
            <li class="breadcrumb-item"><a href="{% url 'courses:course_detail' course.slug %}">{{ course.title }}</a></li>
            <li class="breadcrumb-item"><a href="{% url 'courses:module_content' course.slug module.id %}">Module: {{ module.title }}</a></li>
            <li class="breadcrumb-item active">Quiz: {{ quiz.title }}</li>
        </ol>
    </nav>

    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">{{ quiz.title }}</h3>
        </div>
        <div class="card-body">
            <p>{{ quiz.description }}</p>
            <div class="alert alert-info">
                <p><i class="fas fa-clock"></i> Durée: {{ quiz.time_limit }} minutes</p>
                <p><i class="fas fa-percentage"></i> Score minimum pour réussir: {{ quiz.required_score_to_pass }}%</p>
                <p><i class="fas fa-question-circle"></i> Nombre de questions: {{ questions.count }}</p>
            </div>
            
            <form method="post" id="quiz-form">
                {% csrf_token %}
                
                {% for question in questions %}
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Question {{ forloop.counter }}: {{ question.text }}</h5>
                        <small class="text-muted">{{ question.points }} point{{ question.points|pluralize }}</small>
                    </div>
                    <div class="card-body">
                        {% if question.question_type == 'multiple_choice' %}
                            <!-- Questions à choix multiples -->
                            {% for answer in question.answers.all %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="question_{{ question.id }}" value="{{ answer.id }}" id="answer_{{ answer.id }}">
                                <label class="form-check-label" for="answer_{{ answer.id }}">
                                    {{ answer.text }}
                                </label>
                            </div>
                            {% endfor %}
                        
                        {% elif question.question_type == 'single_choice' %}
                            <!-- Questions à choix unique -->
                            {% for answer in question.answers.all %}
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="question_{{ question.id }}" value="{{ answer.id }}" id="answer_{{ answer.id }}">
                                <label class="form-check-label" for="answer_{{ answer.id }}">
                                    {{ answer.text }}
                                </label>
                            </div>
                            {% endfor %}
                        
                        {% elif question.question_type == 'true_false' %}
                            <!-- Questions vrai/faux -->
                            {% for answer in question.answers.all %}
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="question_{{ question.id }}" value="{{ answer.id }}" id="answer_{{ answer.id }}">
                                <label class="form-check-label" for="answer_{{ answer.id }}">
                                    {{ answer.text }}
                                </label>
                            </div>
                            {% endfor %}
                        
                        {% elif question.question_type == 'short_answer' %}
                            <!-- Questions à réponse courte -->
                            <div class="form-group">
                                <input type="text" class="form-control" name="question_{{ question.id }}" placeholder="Votre réponse">
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg">Soumettre mes réponses</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    // Ajouter un timer pour le quiz
    document.addEventListener('DOMContentLoaded', function() {
        const timeLimit = {{ quiz.time_limit }} * 60; // Convertir en secondes
        let timeRemaining = timeLimit;
        
        const timerDisplay = document.createElement('div');
        timerDisplay.className = 'alert alert-warning mt-3';
        timerDisplay.innerHTML = '<i class="fas fa-hourglass-half"></i> <span id="timer"></span>';
        
        document.querySelector('.card-body').insertBefore(timerDisplay, document.querySelector('form'));
        
        const timerElement = document.getElementById('timer');
        
        function updateTimer() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            
            timerElement.textContent = `Temps restant: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            
            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                document.getElementById('quiz-form').submit();
            }
            
            timeRemaining--;
        }
        
        updateTimer();
        const timerInterval = setInterval(updateTimer, 1000);
    });
</script>
{% endblock %}
{% endblock %}
